- platform: time_date
  display_options:
    - "time"
    - "date"
    - "date_time"
    - "date_time_utc"
    - "date_time_iso"
    - "time_date"
    - "time_utc"

- platform: template
  sensors:
    inst_cool_stage_percent:
      value_template: >-
        {%- if (states('counter.stage_inst_cool')|int(0) < 3) -%}
        {{ 0 }}
        {%- else -%}        
        {{
        (states('counter.inst_cool_stage_idle_time')|int(0) /
        states('input_number.inst_cool_stage_length')|int(0) ) * 100
        | round(0)
        }}
        {%- endif -%}

    inst_cool_session_percent:
      value_template: >-
        {%- if (states('counter.stage_inst_cool')|int(0) < 3) -%}
        {{ 0 | int(0) }}
        {%- else -%}        
        {{
        (states('sensor.inst_cool_total_idle_time')|int(0) /
        states('sensor.inst_cool_total_idle_time_to_8')|int(0) * 100)
        | round(0)
        }}
        {%- endif -%}

    inst_cool_seconds_since_session_start:
      value_template: >-
        "{{ now().timestamp() -
        as_timestamp(states('input_datetime.inst_cool_session_start_time'), 0) }}"
        | int(0) }}"

    inst_cool_total_idle_time_to_8:
      value_template: "{{ states('input_number.inst_cool_stage_length')|int(0) * 5 }}"

    inst_cool_total_idle_time:
      value_template: >-
        {%- if (states('counter.stage_inst_cool')|int(0) < 3) -%}
        {{ 0 | int(0) }}
        {%- else -%}       
        {{
        ((states('counter.stage_inst_cool')| int(0) - 3) *
        states('input_number.inst_cool_stage_length')|int(0)) +
        states('counter.inst_cool_stage_idle_time')|int(0)
        }}
        {%- endif -%}